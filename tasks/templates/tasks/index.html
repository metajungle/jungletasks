{% extends "base.html" %}

{% block title %}{{ block.super }} ({{ num_not_done }}){% endblock %}

{% block stylesheet %}
    <link href="/static/css/tasks.css" rel="stylesheet" type="text/css" />
    <link href="/static/css/labels.css" rel="stylesheet" type="text/css" />
{% endblock %}

{% block script %}
    <script type="text/javascript" src="/static/js/utils.js"></script>
    <script type="text/javascript" src="/static/js/tasks.js"></script>
{% endblock %}

{% block js-on-document-load %}

/* focus on creating tasks input */ 
setInterval(function() {
    $("#inputTask").focus();
}, 200);

/* register action for clicking on 'save' button */
$("button#btn_label_save").click(task_labels_save);
/* register action for clicking on 'close' button */
$("button#btn_label_close").click(dom_label_task_clearup);

$("input.due-date-holder").each(function() {
    $(this).datepicker(
    {
      minDate: new Date(),
      autoSize: true,
      showAnim: 'blind'
    });
    /* get id */
    var data = $(this).metadata();
    /* request to save due date on change */
    if (data && data.task_id) {
        $(this).change(function() {
            api_task_save_due_date(data.task_id);
        });
    }
});

{% endblock %}

{% block action-controls %}
{% if tasks.object_list %}
<a href="{% url 'url_export' %}?label={{ active_label|lower }}" id="btn_export">export</a>
{% endif %}
{% endblock %}

{% block contents %}

<form role="form" action="{% url 'url_tasks_add' %}" method="POST">{% csrf_token %}
<div class="row">
  <div class="col-sm-9">
      <label class="sr-only" for="inputTask">Label</label>
      <input type="text" class="form-control" id="inputTask" name="task" placeholder="New task">
  </div>
  <div class="col-sm-3">
    <button type="submit" class="btn btn-primary form-control">&plus; add task</button>
  </div>
</div>
</form>

<p></p>

<div class="row">
    <div class="col-sm-9">
        
        {% if tasks.object_list %}
        <table class="table">
          <tr class="table_header">
            <th class="empty">&nbsp;</th>
            <th>
      	Items
            </th>
            <th>&nbsp;</th>
            {# <th>Due</th> #}
            <th>&nbsp;</th>
          </tr>
          {% for task in tasks.object_list %}
          <tr id="task{{ task.id }}"
      	class="task_item {% if task.done %}task_done{% else %}task_not_done{% endif %} {% if task.pri_high %}priority-high{% endif %}"
      	data-labels="[{% for l in task.labels.all %}'{{ l.id }}'{% if not forloop.last %},{% endif %}{% endfor %}]">
            {# Priority column #}
            <td class="status narrow">
      	&nbsp;
            </td>
            <td class="task">
      	<a href="#" class="task_text" onClick="return dom_task_toggle('{{ task.id }}');">{{ task.task }}</a>
	
      	{# show task labels #}
      	<ul class="label-crumbs">
      	{% for label in task.labels.all %}
      	{% if not label.is_hidden %}
      	<li>
      	  <span class="label-small">{{ label.name }}</span>
      	</li>
      	{% endif %}
      	{% endfor %}
      	</ul>
      
            </td>
            <td class="icon-cell narrow">
      	<a href="{% url 'url_form_task_edit' %}?t_id={{ task.id }}{% if get and get.l %}&orig_l={{ get.l }}{% endif %}"
      	   style="display: {% if task.done %}none{% else %}inline{% endif %}"
      	   class="task_edit"><span class="task-edit-icon"></span></a>
            </td>
            {# <td class="task_due_date"> #}
      	{# <input type="text" class="due-date-holder hand" #}
      	   {#    data-task_id="'{{ task.id }}'" #}
      	     {#  value="{% if task.due %}{{ task.due|date:"SHORT_DATE_FORMAT" }}{% else %}&mdash;{% endif %}" /> #}
            {# </td> #}
            <td class="icon-cell narrow">
      	<a href="#" onClick="return dom_label_task('{{ task.id }}');"><img class="task_icon" src="/static/icons/tag.png" alt="Edit labels" /></a>
            </td>
          </tr>
          {% endfor %}
    
          {# PAGINATION #}
          {% if tasks.paginator.num_pages > 1 %}
          <tr class="pagination">
            <td class="empty">&nbsp;</td>
            <td colspan="4">
                {% if tasks.has_previous %}
                    <a href="?{{ get_values }}page={{ tasks.previous_page_number }}">Previous</a> &#124;
                {% endif %}
                <span class="current">
                    Page {{ tasks.number }} of {{ tasks.paginator.num_pages }}
                </span>
                {% if tasks.has_next %}
                    &#124; <a href="?{{ get_values }}page={{ tasks.next_page_number }}">Next</a>
                {% endif %}
            </td>
          </tr>
          {% endif %}
  
        </table>
  
        {% else %}
        <p><strong>There are no tasks here.</strong></p>
        <p><em>Try adding a task first.</em></p>
        {% endif %}
        
    </div>
    <div class="col-sm-3">
        <ul id="folders">
    
          {% load tasks_tags %}
          {% url 'url_tasks_inbox' as url_tasks_inbox %}
          {% url 'url_tasks_all' as url_tasks_all %}
    
          {# standard labels #}
          <li class="standard {% current active_label url_tasks_inbox %}">
              <a href="{{ url_tasks_inbox }}">Inbox&nbsp({{ num_not_done }})</a>
          </li>
          <li class="standard {% current active_label url_tasks_all %}">
              <a href="{{ url_tasks_all }}">All</a>
          </li>
          <li class="separator">&nbsp;</li>
    
          {# user-defined labels #}
          <li class="title user-defined-labels">Your labels</li>
          {% block labels %}
          {% for label in labels %}
          <li class="label userlabel {% current active_label label.name %} {% if label.is_hidden %}hidden{% endif %}" data-label_id="'{{ label.id }}'"
      	style="background-color: #{{ label.color }}">
            <a href="?l={{ label.name }}">{{ label.name }}&nbsp;({{ label.num_not_done_tasks }})</a>
          </li>
          {% empty %}
          <li class="empty">&nbsp;</li>
          {% endfor %}
          {# save button for labeling #}
          <li class="labeling-buttons">
            <button id="btn_label_save">Save and close</button>
            <button id="btn_label_close">Cancel</button>
          </li>
          {% endblock %}
    
          {% if user.get_profile and user.get_profile.system_labels.all %}
          <li class="separator system-label-part">&nbsp;</li>
          <li class="title system-label-part">System labels</li>
          {% block systemlabels %}
          {% for label in user.get_profile.system_labels.all %}
          <li class="systemlabel system-label-part">
            <a href="?l=s:{{ label.label }}">{{ label.get_label_display }}</a>
          </li>
          {% endfor %}
          {% endblock %}
          {% endif %}
    
          {# <li class="empty">&nbsp;</li> #}
    
          {# <li class="separator">&nbsp;</li> #}
          {# <li class="title">Smart labels</li> #}
          {# {% block smartlabels %} #}
          {# <li class="empty">&nbsp;</li> #}
          {# {% endblock %} #}
  
        </ul>        
    </div>
</div>

<div id="contents-inner">
<div id="sidebar">

</div>

<div id="main">
  


</div>

<div style="clear: both;"></div>

</div>
{% endblock %}

